<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS 4.5 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>AtoTheQ</title>
</head>

<body>
    <div class="container-fluid" id="app">

        <!------------------------------------------------------------------------------------------------------------------------------>
        <!-- NAVBAR -->
        <!-- NAVBAR -->
        <nav class="navbar navbar-expand-lg navbar-dark border border-primary">
            <a class="navbar-brand" href="index.html">A to The Q</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <a v-show="admin" class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Admin Site</a>
                </ul>
                <ul id="navbarUser" class="navbar-nav">
                    <li class="nav-logged-in">
                        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">{{ username }}</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownUser" role="button"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Account
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <span v-show="loggedIn"><a class="dropdown-item disabled" href="#" tabindex="-1"
                                    aria-disabled="true">{{ username }}</a></span>
                            <span v-show="loggedIn"><a class="dropdown-item disabled" href="#" tabindex="-1"
                                    aria-disabled="true">{{ userlevel }}</a></span>
                            <span v-show="loggedIn">
                                <div class="dropdown-divider"></div>
                            </span>
                            <span v-show="admin"><a class="dropdown-item" href="adminSite.html">Admin</a></span>
                            <span v-show="loggedIn"><a class="dropdown-item" href="#" data-toggle="modal"
                                    v-on:click="selectUser(user)" data-target="#updateUserModal">Settings</a></span>
                            <span v-show="!loggedIn"><a class="dropdown-item" href="#" data-toggle="modal"
                                    data-target="#addUserModal">Register</a></span>
                            <span v-show="!loggedIn"><a class="dropdown-item" href="#" data-toggle="modal"
                                    data-target="#loginModal">Log in</a></span>
                            <span v-show="loggedIn"><a class="dropdown-item" href="#" v-on:click="logOutUser()">Log
                                    out</a></span>
                        </div>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0">
                    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                </form>
            </div>
        </nav>


        <!------------------------------------------------------------------------------------------------------------------------------>
        
        <!-- PAGE HEADER -->
        <!-- PAGE HEADER -->
        <div v-show="admin" class="container container-pg-head">
            <h1 class="h1-pg text-center">Admin Site</h1>
        </div>

        <!-- USERS -->
        <!-- USERS -->
        <div v-show="admin" class="container-fluid table-responsive-lg border border-primary admin-tables">
            <button class="btn btn-primary btn-card" data-toggle="modal" v-on:click="unselectUser()"
                data-target="#addUserModal">New User</button>
            <label class="table-label" for="usersTable">USERS</label>
            <table class="table table-image" id="usersTable">
                <thead>
                    <tr class="admin-table">
                        <th scope="col">Id</th>
                        <th scope="col">Accesslevel</th>
                        <th scope="col">Username</th>
                        <th scope="col">Firstname</th>
                        <th scope="col">Lastname</th>
                        <th scope="col">Email</th>
                        <th scope="col" class="user-actions">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="admin-table" v-for="item in users" :key="item.id">
                        <td>{{ item.id }}</td>
                        <td>{{ item.accessLevel }}</td>
                        <td>{{ item.username }}</td>
                        <td>{{ item.fname }}</td>
                        <td>{{ item.lname }}</td>
                        <td>{{ item.email}}</td>
                        <td>
                            <button type="button" class="btn btn-primary" data-toggle="modal"
                                data-target="#updateUserModal" v-on:click="selectUser(item)">
                                Update info
                            </button>
                            <button type="button" class="btn btn-warning" data-toggle="modal" v-on:click="banUser(item)">
                                Ban user
                            </button>
                            <button type="button" class="btn btn-danger" data-toggle="modal"
                                v-on:click="deleteUser(item)">
                                Delete
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- QUERIES -->
        <!-- QUERIES -->
        <div v-show="admin" class="container-fluid table-responsive-lg border border-primary admin-tables">
            <button class="btn btn-primary btn-card" data-toggle="modal" v-on:click="unselectQuery()"
                data-target="#addQueryModal">New Query</button>
            <label class="table-label" for="queriesTable">QUERIES</label>
            <table class="table table-image" id="queriesTable">
                <thead>
                    <tr class="admin-table">
                        <th scope="col">Id</th>
                        <th scope="col">Posted</th>
                        <th scope="col">Posted by ID</th>
                        <th scope="col">Posted by user</th>
                        <th scope="col">Title</th>
                        <th scope="col">Category</th>
                        <th scope="col">Description</th>
                        <th scope="col">Answers</th>
                        <th scope="col">Duplicate_of</th>
                        <th scope="col" class="query-actions">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="admin-table" v-for="item in queries" :key="item.id">
                        <td>{{ item.id }}</td>
                        <td>{{ item.time }}</td>
                        <td>{{ item.userId }}</td>
                        <td>{{ item.username }}</td>
                        <td class="table-row-height">{{ item.title }}</td>
                        <td>{{ item.category }}</td>
                        <td class="table-row-height">{{ item.description}}</td>
                        <td>{{ item.answers}}</td>
                        <td>{{ item.duplicateOf}}</td>
                        <td>
                            <button type="button" class="btn btn-primary" data-toggle="modal"
                                data-target="#updateQueryModal" v-on:click="selectQuery(item)">
                                Update
                            </button>
                            <button type="button" class="btn btn-info" data-toggle="modal"
                                data-target="#queryModal" v-on:click="openQuery(item)">Show</button>
                            <button type="button" class="btn btn-danger" data-toggle="modal"
                                v-on:click="deleteQuery(item)">
                                Delete
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!------------------------------------------------------------------------------------------------------------------------------>
        <!-- MODALS -->
        <!-- MODALS -->

        <!-- ADD USER MODAL -->
        <!-- ADD USER MODAL -->
        <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true"
            :item="item">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addUserLabel">New user</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="resetAddUserModal()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <!-- <img v-bind:src="selectedItem.picture" class="card-img-top" alt="..."> -->
                    <div class="modal-body">
                        <form id="formAddUser">
                            <div class="form-group modalColor">
                                <label for="newAccessLevel">Access level</label>
                                <select class="form-control" name="newAccessLevel" id="newAccessLevel"
                                    v-bind:value="selectedUser.accessLevel">
                                    <option type="number">1</option>
                                    <option type="number">2</option>
                                    <option type="number">3</option>
                                </select>
                            </div>
                            <div class="form-group modalColor">
                                <label for="newUsername">Username</label>
                                <input type="text" class="form-control" name="newUsername" id="newUsername"
                                    v-bind:value="selectedUser.username">
                            </div>
                            <div class="form-group modalColor">
                                <label for="newPassword">Password</label>
                                <input type="text" class="form-control" name="newPassword" id="newPassword" 
                                    v-bind:value="selectedUser.password">
                            </div>
                            <div class="form-group modalColor">
                                <label for="newFname">Firstname</label>
                                <input type="text" class="form-control" name="newFname" id="newFname"
                                    v-bind:value="selectedUser.fname">
                            </div>
                            <div class="form-group modalColor">
                                <label for="newLname">Lastname</label>
                                <input type="text" class="form-control" name="newLname" id="newLname"
                                    v-bind:value="selectedUser.lname">
                            </div>
                            <div class="form-group modalColor">
                                <label for="newEmail">Email</label>
                                <input type="email" class="form-control" name="newEmail" id="newEmail" 
                                    v-bind:value="selectedUser.email">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer modalColor">
                        <button type="button" class="btn btn-primary" v-on:click="addUser()" data-dismiss="modal">Save
                            changes</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" v-on:click="resetAddUserModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPDATE USER MODAL -->
        <!-- UPDATE USER MODAL -->
        <div class="modal fade" id="updateUserModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true"
            :item="item">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateUserLabel">Update user</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="resetUpdateUserModal()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <!-- <img v-bind:src="selectedItem.picture" class="card-img-top" alt="..."> -->
                    <div class="modal-body">
                        <form id="formUpdateUser">
                            <div class="form-group modalColor">
                                <label for="updateId">ID</label>
                                <input type="text" class="form-control" name="updateId" id="updateId"
                                    v-bind:value="selectedUser.id" readonly>
                            </div>
                            <div class="form-group modalColor">
                                <label for="updateAccessLevel">Access level</label>
                                <select class="form-control" name="updateAccessLevel" id="updateAccessLevel"
                                    v-bind:value="selectedUser.accessLevel">
                                    <option type="number">1</option>
                                    <option type="number">2</option>
                                    <option type="number">3</option>
                                </select>
                            </div>
                            <div class="form-group modalColor">
                                <label for="updateUsername">Username</label>
                                <input type="text" class="form-control" name="updateUsername" id="updateUsername"
                                    v-bind:value="selectedUser.username">
                            </div>
                            <div class="form-group modalColor">
                                <label for="updateFname">Firstname</label>
                                <input type="text" class="form-control" name="updateFname" id="updateFname"
                                    v-bind:value="selectedUser.fname">
                            </div>
                            <div class="form-group modalColor">
                                <label for="updateLname">Lastname</label>
                                <input type="text" class="form-control" name="updateLname" id="updateLname"
                                    v-bind:value="selectedUser.lname">
                            </div>
                            <div class="form-group modalColor">
                                <label for="updateEmail">Email</label>
                                <input type="email" class="form-control" name="updateEmail" id="updateEmail"
                                    v-bind:value="selectedUser.email">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer modalColor">
                        <button type="button" class="btn btn-primary" v-on:click="updateUser()" data-dismiss="modal">Save
                            changes</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" v-on:click="resetUpdateUserModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- QUERY MODAL -->
        <!-- QUERY MODAL -->
        <div class="modal fade" id="queryModal" tabindex="-1" aria-labelledby="queryModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="queryModalLabel">{{ selectedQuery.title }}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="unselectQuery()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Asked by: {{ selectedQuery.username }} | Category: {{ selectedQuery.category }}</p>
                        {{ selectedQuery.description }}
                    </div>
                    <div class="modal-body modal-height-lg">
                        <div class="col" v-for="item in answers" :key="item.id">
                            <div class="card h-100 border rounded">
                                <div class="card-body">
                                    <p class="card-text">Reply by: {{ item.userId }}</p>
                                    <p class="card-text">{{ item.answer }}</p>
                                    <p class="card-text">Quality: {{ item.vote }}</p>
                                    <p class="card-text"><small>Posted: {{ item.time }}</small></p>
                                    <button type="button" class="btn btn-primary" v-show="contributor"
                                        v-on:click="upvoteAnswer(item)">Good</button>
                                    <button type="button" class="btn btn-danger" v-show="contributor"
                                        v-on:click="downvoteAnswer(item)">Bad</button>
                                    <button v-show="admin" type="button" class="btn btn-danger btn-right"
                                        data-target="deleteAnswer(item)">Delete</button>
                                    <button v-show="admin" type="button" class="btn btn-info btn-right btn-margin" data-target="#updateAnswerModal" data-toggle="modal"
                                        v-on:click="selectAnswer(item)">Update</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div v-show="contributor">
                            <button type="button" class="btn btn-primary" data-dismiss="modal" data-toggle="modal"
                                data-target="#answerModal">Reply</button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" data-toggle="modal"
                                v-show="contributor" data-target="#markDuplicateModal">Mark duplicate</button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                v-on:click="unselectQuery()">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ANSWER MODAL -->
        <!-- ANSWER MODAL -->
        <div class="modal fade" id="answerModal" tabindex="-1" aria-labelledby="answerModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="answerModalLabel">{{ selectedQuery.title }}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="resetAnswerModal()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Asked by: {{ selectedQuery.username }}</p>
                        {{ selectedQuery.description }}
                    </div>
                    <span></span>
                    <form class="modal-body">
                        <div class="form-group modalColor">
                            <label for="inputAnswer">Answer</label>
                            <textarea class="form-control" id="inputAnswer" placeholder="Answer" rows="6"
                                v-model="answer"></textarea>
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal" v-show="contributor"
                            v-on:click="sendAnswer()">Reply</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                            v-on:click="resetAnswerModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPDATE ANSWER MODAL -->
        <!-- UPDATE ANSWER MODAL -->
        <div class="modal fade" id="updateAnswerModal" tabindex="-1" aria-labelledby="updateAnswerModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateAnswerModalLabel">{{ selectedAnswer.title }}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="resetUpdateAnswerModal()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <form class="modal-body">
                            <div class="form-group modalColor">
                                <label for="updateAnswer">Answer</label>
                                <textarea class="form-control" id="updateAnswer" placeholder="selectedAnswer.answer" rows="6"
                                    v-bind:value="selectedAnswer.answer"></textarea>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal" v-show="contributor"
                                v-on:click="updateAnswer()">Reply</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                v-on:click="resetUpdateAnswerModal()">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADD QUERY MODAL -->
        <!-- ADD QUERY MODAL -->
        <div class="modal fade" id="addQueryModal" tabindex="-1" aria-labelledby="queryModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addQueryModalLabel">Make a query</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="resetAddQueryModal()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group modalColor">
                                <label for="inputTitle">Title</label>
                                <input type="text" class="form-control" id="inputTitle" placeholder="Enter title" title="title"
                                    v-model="title">
                            </div>
                            <div class="form-group modalColor">
                                <label for="inputCategory">Category</label>
                                <select class="form-control" name="inputCategory" id="inputCategory" v-model="category">
                                    <option type="text">Computer</option>
                                    <option type="text">Cellphone</option>
                                    <option type="text">Broadband</option>
                                    <option type="text">Telephony</option>
                                </select>
                            </div>
                            <div class="form-group modalColor">
                                <label for="inputDescription">Description</label>
                                <textarea class="form-control" id="inputDescription" placeholder="Description" rows="6"
                                    description="description" v-model="description"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" v-on:click="sendQuery()"
                            data-dismiss="modal">Submit</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                            v-on:click="resetAddQueryModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPDATE QUERY MODAL -->
        <!-- UPDATE QUERY MODAL -->
        <div class="modal fade" id="updateQueryModal" tabindex="-1" aria-labelledby="queryModalLabel" aria-hidden="true"
            :item="item">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateQueryModalLabel">Update query</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="resetUpdateQueryModal()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group modalColor">
                                <label for="inputTitle">Title</label>
                                <input type="text" class="form-control" name="updateTitle" id="updateTitle"
                                    v-bind:value="selectedQuery.title">
                            </div>
                            <div class="form-group modalColor">
                                <label for="updateCategory">Category</label>
                                <select class="form-control" name="updateCategory" id="updateCategory"
                                    v-bind:value="selectedQuery.category">
                                    <option type="text">Computer</option>
                                    <option type="text">Cellphone</option>
                                    <option type="text">Broadband</option>
                                    <option type="text">Telephony</option>
                                </select>
                            </div>
                            <div class="form-group modalColor">
                                <label for="updateDescription">Description</label>
                                <textarea class="form-control" name="updateDescription" id="updateDescription" rows="6"
                                    v-bind:value="selectedQuery.description"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" v-on:click="updateQuery()"
                            data-dismiss="modal">Submit</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                            v-on:click="resetUpdateQueryModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MARK DUPLICATE MODAL -->
        <!-- MARK DUPLICATE MODAL -->
        <div class="modal fade" id="markDuplicateModal" tabindex="-1" aria-labelledby="markDuplicateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="markDuplicateModalLabel">{{ selectedQuery.title }}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="resetDuplicateModal()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group modalColor">
                            <label for="selectOriginal">Select original query ID</label>
                            <select class="form-control" name="selectOriginal" id="selectOriginal" :key="item.id">
                                <option v-for="item in queries" type="text">{{ item.id }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal" v-show="contributor"
                            v-on:click="markDuplicate(item)">Save</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                            v-on:click="resetDuplicateModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <!------------------------------------------------------------------------------------------------------------------------------>
    <!-- FOOTER -->
    <!-- FOOTER -->
    <footer class="border border-primary border-left-0 border-right-0 border-bottom-0">
        <div class="container-fluid">
            <div class="row just">
                <div class="col-sm d-flex justify-content-start">
                    <a class="social-icons" href="https://www.facebook.com">
                        <img class="social-link" src="./pictures/facebook_W_icon.png" alt="Link To Facebook">
                    </a>
                    <a class="social-icons" href="https://www.twitter.com">
                        <img class="social-link" src="./pictures/twitter_W_icon.png" alt="Link To Twitter">
                    </a>
                </div>
                <div id="footer-textC" class="footer-text col-sm d-flex">
                    <p>AtoQ TM</p>
                </div>
                <div id="footer-textL" class="footer-text col-sm d-flex">
                    <p>Made with the help of<a href="https://getbootstrap.com"> Bootstrap</a>...and stuff</p>
                </div>
            </div>
        </div>
    </footer>


    <!------------------------------------------------------------------------------------------------------------------------------>
    <!-- SCRIPT -->
    <!-- SCRIPT -->
    <!-- BOOTSTRAP JS 4.5 -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <!-- development version, includes helpful console warnings -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <script>
        new Vue({
            el: '#app',
            data: {
                queries: [],
                answers: [],
                item: [],
                selectedItem: '',
                selectedUser: '',
                selectedQuery: '',
                selectedAnswer: '',
                email: '',
                password: '',
                user: [],
                users: [],
                username: 'Not logged in',
                userlevel: "",
                loggedIn: false,
                admin: false,
                contributor: false,
                consumer: false,
                emailUsername: "",
                newUsername: "",
                newEmail: "",
                newPassword: "",
                newFname: "",
                newLname: "",
                title: "",
                description: "",
                category: ""
            },
            methods: {

                //########## USER LOGIN ##########
                async loginUser(emailUsername, password) {
                    var userLogin = { 'emailUsername': emailUsername, 'password': password };
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/login/',
                        type: 'POST',
                        data: userLogin,
                        success: function (response) {
                            var self = this;
                            self.user = response;
                            self.username = self.user.username;
                            self.loggedIn = true;
                            var parsed = JSON.stringify(this.user)
                            sessionStorage.setItem('user', parsed)
                            alert(`User ${response.username} logged in`);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            alert(`Error!\n${jqXHR.responseText}\nUnable to login`);
                        }
                    });
                    this.checkLoggedIn();
                },
                async logOutUser() {
                    this.loggedIn = false;
                    this.contributor = false;
                    this.admin = false;
                    this.consumer = false;
                    this.user = [];
                    this.username = 'Not logged in';
                    sessionStorage.removeItem('user');
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/logout/',
                        type: 'DELETE',
                        success: function () {
                            alert("User logged out");
                            if (!alert) {
                                return
                            }
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            alert(`Error!\n${jqXHR.responseText}\nUnable to logout from server`);
                        }
                    });
                    this.users = [];
                    this.queries = [];
                    window.location.href = '/index.html';
                },
                checkLoggedIn() {
                    if (sessionStorage.getItem('user')) {
                        this.user = [];
                        this.user = JSON.parse(sessionStorage.getItem('user'));
                        this.username = this.user.username;
                        this.loggedIn = true;
                        if (this.user.accessLevel < 1) {
                            this.banned = true;
                        }
                        else {
                            this.consumer = true;
                            if (this.user.accessLevel < 2) {
                                this.userlevel = "User";
                            }
                            else {
                                this.contributor = true;
                                if (this.user.accessLevel < 3) {
                                    this.userlevel = "Contributor";
                                }
                                else {
                                    this.admin = true;
                                    if (this.user.accessLevel == 3) {
                                        this.userlevel = "Super Admin";
                                    }
                                    else {
                                        this.userlevel = "wat";
                                    }
                                }
                            }
                        }
                    }
                },
                notLoggedIn() {
                    this.loggedIn = false;
                    this.contributor = false;
                    this.admin = false;
                    this.consumer = false;
                    this.user = [];
                    this.username = 'Not logged in';
                },

                //########## UPDATE ##########
                async updateQueries() {
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/queries/',
                        type: 'GET',
                        success: (response) => {
                            var self = this;
                            self.queries = response;
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            if (jqXHR.status != '404') {
                                alert(`${jqXHR.responseText}`);
                            }
                        }
                    });
                    for (let i = 0; i < this.queries.length; i++){
                        if (this.queries[i].duplicateOf == "-1") {
                            this.queries[i].duplicateOf = "";
                        }
                    }
                },
                async updateUsers() {
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/users/',
                        type: 'GET',
                        success: (response) => {
                            var self = this;
                            self.users = response;
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            if (jqXHR.status != '404') {
                                alert(`${jqXHR.responseText}`);
                            }
                        }
                    });
                },
                selectUser(item) {
                    this.selectedUser = item;
                },
                selectQuery(item) {
                    this.selectedQuery = item;
                },
                selectAnswer(item) {
                    this.selectedAnswer = item;
                },
                unselectUser() {
                    this.selectedUser = '';
                },
                unselectQuery() {
                    this.selectedQuery = '';
                },
                unselectAnswer() {
                    this.selectedAnswer = '';
                },
                openQuery(item) {
                    this.selectQuery(item);
                    this.populateAnswers();
                },

                //########## USER HANDLING ##########
                async addUser() {
                    var message;
                    var user = {
                        accessLevel: $('#addUserModal #newAccessLevel').val(),
                        username: $('#addUserModal #newUsername').val(),
                        password: $('#addUserModal #newPassword').val(),
                        fname: $('#addUserModal #newFname').val(),
                        lname: $('#addUserModal #newLname').val(),
                        email: $('#addUserModal #newEmail').val()
                    }
                    await $.ajax({
                        url: '/user/',
                        type: 'POST',
                        data: user,
                        success: (response) => {
                            message = response;
                            alert(message);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to save user`);
                            alert(message);
                        }
                    });
                    this.resetAddUserModal();
                    this.updateUsers();
                },
                async updateUser() {
                    var message;
                    var user = {
                        id: $('#updateUserModal #updateId').val(),
                        accessLevel: $('#updateUserModal #updateAccessLevel').val(),
                        username: $('#updateUserModal #updateUsername').val(),
                        //password: $('#updateUserModal #updatePassword').val(),
                        fname: $('#updateUserModal #updateFname').val(),
                        lname: $('#updateUserModal #updateLname').val(),
                        email: $('#updateUserModal #updateEmail').val()
                    }
                    await $.ajax({
                        url: '/user/admin',
                        type: 'PUT',
                        data: user,
                        success: (response) => {
                            message = response;
                            alert(message);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to update user`);
                            alert(message);
                        }
                    });
                    this.unselectUser();
                    this.resetUpdateUserModal();
                    this.updateUsers();
                },
                async banUser(item) {
                    var question = confirm("Are you sure you want to ban user?");
                    if (question) {
                        var message;
                        var user = {
                            id: item.id,
                            accessLevel: 0,
                            username: item.username,
                            //password: item.password,
                            fname: item.fname,
                            lname: item.lname,
                            email: item.email
                        }
                        //item.accessLevel=0;
                        console.log(user);
                        await $.ajax({
                            url: '/user/admin/',
                            type: 'PUT',
                            data: user,
                            success: () => {
                                alert(`User with ID: ${item.id} has been banned`);
                            },
                            error: function (jqXHR, textStatus, error) {
                                console.log(jqXHR.status, error, jqXHR.responseText);
                                message = (`Error!\n${jqXHR.responseText}\nUnable to ban user`);
                                alert(message);
                            }
                        });
                        this.updateUsers();
                    }
                },
                async deleteUser(item) {
                    var question = confirm("Are you sure you want to delete user?");
                    if (question) {
                        var message;
                        var user = item;
                        var userData = { "id": user.id };
                        await $.ajax({
                            url: '/user/',
                            type: 'DELETE',
                            data: userData,
                            success: (response) => {
                                alert(response);
                            },
                            error: function (jqXHR, textStatus, error) {
                                console.log(jqXHR.status, error, jqXHR.responseText);
                                message = (`Error!\n${jqXHR.responseText}\nUnable to delete user`);
                                alert(message);
                            }
                        });
                        this.updateUsers();
                    }
                },

                //########## QUERY HANDLING ##########
                async sendQuery() {
                    var message;
                    var query = {
                        title: $('#addQueryModal #inputTitle').val(),
                        category: $('#addQueryModal #inputCategory').val(),
                        description: $('#addQueryModal #inputDescription').val(),
                    }
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/query/',
                        type: 'POST',
                        data: query,
                        success: (response) => {
                            message = JSON.parse(JSON.stringify(response));
                            alert(`Query with ID: ${message.id} saved`);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to save query`);
                            alert(message);
                        }
                    });
                    this.resetAddQueryModal();
                    this.updateQueries();
                },
                async updateQuery() {
                    var message;
                    var query = {
                        id: this.selectedQuery.id,
                        title: $('#updateQueryModal #updateTitle').val(),
                        category: $('#updateQueryModal #updateCategory').val(),
                        description: $('#updateQueryModal #updateDescription').val(),
                    }
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/query/',
                        type: 'PUT',
                        data: query,
                        success: (response) => {
                            message = JSON.parse(JSON.stringify(response));
                            alert(`Query with ID: ${message.id} updated`);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to save query`);
                            alert(message);
                        }
                    });
                    this.unselectQuery();
                    this.resetUpdateQueryModal()
                    this.updateQueries();
                },
                async deleteQuery(item) {
                    var question = confirm("Are you sure you want to delete query?");
                    if (question) {
                        var message;
                        var query = item;
                        var queryData = { "id": query.id };
                        await $.ajax({
                            url: 'http://127.0.0.1:5000/query/',
                            type: 'DELETE',
                            data: queryData,
                            success: (response) => {
                                alert(response);
                            },
                            error: function (jqXHR, textStatus, error) {
                                console.log(jqXHR.status, error, jqXHR.responseText);
                                message = (`Error!\n${jqXHR.responseText}\nUnable to delete query`);
                                alert(message);
                            }
                        });
                        this.updateQueries();
                    }
                },
                async markDuplicate(item) {
                    var message;
                    var originalQuery = $('#markDuplicateModal #selectOriginal').val();
                    var query = {
                        id: this.selectedQuery.id,
                        duplicateOf: $('#markDuplicateModal #selectOriginal').val(),
                    }
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/query/flagDupe',
                        type: 'PUT',
                        data: query,
                        success: (response) => {
                            message = JSON.parse(JSON.stringify(response));
                            alert(`Query marked as duplicate of query with ID: ${originalQuery}`);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to save query`);
                            alert(message);
                        }
                    });
                    this.unselectQuery();
                    this.resetDuplicateModal()
                    this.updateQueries();
                },
                async sendAnswer() {
                    var message;
                    var answer = {
                        queryId: this.selectedQuery.id,
                        answer: $('#answerModal #inputAnswer').val(),
                        userId: this.user.id,
                    }
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/answer/',
                        type: 'POST',
                        data: answer,
                        success: () => {
                            alert(`Reply to query with ID: ${this.selectedQuery.id} posted`);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to save query`);
                            alert(message);
                        }
                    });
                    this.unselectQuery();
                    this.resetAnswerModal();
                    this.updateQueries();
                },
                async updateAnswer() {
                    var message;
                    var answer = {
                        id: this.selectedAnswer.id,
                        answer: $('#updateAnswerModal #updateAnswer').val(),
                    }
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/answer/',
                        type: 'PUT',
                        data: answer,
                        success: () => {
                            alert(`Answer with ID: ${this.selectedAnswer.id} updated`);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to save query`);
                            alert(message);
                        }
                    });
                    this.unselectAnswer();
                    this.resetupdateAnswerModal();
                    this.updateQueries();
                },
                async upvoteAnswer(item) {
                    var message;
                    var answer = {
                        id: item.id,
                        vote: item.vote = 1
                    }
                    console.log(answer);
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/answer/',
                        type: 'PUT',
                        data: answer,
                        success: (response) => {
                            //message = response;
                            alert(`Upvote to answer with ID: ${item.id} registered`);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to update query`);
                            alert(message);
                        }
                    });
                    this.updateQueries();
                },
                async downvoteAnswer(item) {
                    var message;
                    var answer = {
                        id: item.id,
                        vote: item.vote = -1
                    }
                    console.log(query);
                    await $.ajax({
                        url: 'http://127.0.0.1:5000/answer/',
                        type: 'PUT',
                        data: answer,
                        success: (response) => {
                            //message = response;
                            alert(`Upvote to answer with ID: ${item.id} registered`);
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            message = (`Error!\n${jqXHR.responseText}\nUnable to update query`);
                            alert(message);
                        }
                    });
                    this.updateQueries();
                },
                async deleteAnswer(item) {
                    var question = confirm("Are you sure you want to delete answer?");
                    if (question) {
                        var message;
                        var answer = item;
                        var queryData = { "id": answer.id };
                        await $.ajax({
                            url: 'http://127.0.0.1:5000/answer/',
                            type: 'DELETE',
                            data: queryData,
                            success: (response) => {
                                alert(response);
                            },
                            error: function (jqXHR, textStatus, error) {
                                console.log(jqXHR.status, error, jqXHR.responseText);
                                message = (`Error!\n${jqXHR.responseText}\nUnable to delete query`);
                                alert(message);
                            }
                        });
                        this.updateQueries();
                        this.populateAnswers();
                    }
                },
                async populateAnswers() {
                    this.answers = [];
                    var id = this.selectedQuery.id;
                    await $.ajax({
                        url: `http://127.0.0.1:5000/answers/${id}`,
                        type: 'GET',
                        success: (response) => {
                            var self = this;
                            self.answers = response;
                        },
                        error: function (jqXHR, textStatus, error) {
                            console.log(jqXHR.status, error, jqXHR.responseText);
                            if (jqXHR.status != '404') {
                                alert(`${jqXHR.responseText}`);
                            }
                        }
                    });
                },

                //########## RESET MODALS ##########
                resetAddUserModal() {
                    $('#addUserModal #newAccessLevel').val("");
                    $('#addUserModal #newUsername').val("");
                    $('#addUserModal #newPassword').val("");
                    $('#addUserModal #newFname').val("");
                    $('#addUserModal #newLname').val("");
                    $('#addUserModal #newEmail').val("");
                },
                resetUpdateUserModal() {
                    $('#updateUserModal #updateId').val("");
                    $('#updateUserModal #updateAccessLevel').val("");
                    $('#updateUserModal #updateUsername').val("");
                    //$('#updateUserModal #updatePassword').val("");
                    $('#updateUserModal #updateFname').val("");
                    $('#updateUserModal #updateLname').val("");
                    $('#updateUserModal #updateEmail').val("");
                    this.updateUsers();
                },
                resetAddQueryModal() {
                    $('#addQueryModal #inputTitle').val("");
                    $('#addQueryModal #inputCategory').val("");
                    $('#addQueryModal #inputDescription').val("");
                },
                resetUpdateQueryModal() {
                    $('#updateQueryModal #updateTitle').val("");
                    $('#updateQueryModal #updateCategory').val("");
                    $('#updateQueryModal #updateDescription').val("");
                    this.updateQueries();
                },
                resetAnswerModal() {
                    $('#answerModal #inputAnswer').val("");
                },
                resetUpdateAnswerModal() {
                    $('#updateAnswerModal #updateAnswer').val("");
                    this.populateAnswers();
                },
                resetDuplicateModal() {
                    $('#markDuplicateModal #selectOriginal').val("");
                },
            },

            //########## MOUNTED ##########
            mounted() {
                this.checkLoggedIn();
                if (this.loggedIn) {
                    this.updateQueries();
                    this.updateUsers();
                }
                else {
                    this.notLoggedIn();
                }
            }
        });
    </script>

</body>

</html>